Vtx water_top_vtx_copies[114] = {
	{{{0, -314, 5988},0, {724, 3207},{0x52, 0xA8, 0xCD, 0x7E}}},
	{{{3520, -314, 4844},0, {1541, 3207},{0x52, 0xA8, 0xCD, 0x7E}}},
	{{{3545, -84, 4879},0, {1542, 3207},{0x52, 0xA8, 0xCD, 0x7E}}},
	{{{5735, -84, 1864},0, {1051, 3207},{0x52, 0xA8, 0xCD, 0x7E}}},
	{{{5695, -314, 1850},0, {1054, 3207},{0x52, 0xA8, 0xCD, 0x7E}}},
	{{{5735, -84, -1864},0, {521, 3207},{0x52, 0xA8, 0xCD, 0x7E}}},
	{{{5695, -314, -1850},0, {526, 3207},{0x52, 0xA8, 0xCD, 0x7E}}},
	{{{3545, -84, -4879},0, {1542, 3207},{0x52, 0xA8, 0xCD, 0x7E}}},
	{{{3520, -314, -4844},0, {1541, 3207},{0x52, 0xA8, 0xCD, 0x7E}}},
	{{{0, -84, -6031},0, {724, 3207},{0x52, 0xA8, 0xCD, 0x7E}}},
	{{{0, -314, -5988},0, {724, 3207},{0x52, 0xA8, 0xCD, 0x7E}}},
	{{{-3545, -84, -4879},0, {1533, 3207},{0x52, 0xA8, 0xCD, 0x7E}}},
	{{{-3520, -314, -4844},0, {1531, 3207},{0x52, 0xA8, 0xCD, 0x7E}}},
	{{{-5735, -84, -1864},0, {531, 3207},{0x52, 0xA8, 0xCD, 0x7E}}},
	{{{-5695, -314, -1850},0, {536, 3207},{0x52, 0xA8, 0xCD, 0x7E}}},
	{{{-5735, -84, 1864},0, {1060, 3207},{0x52, 0xA8, 0xCD, 0x7E}}},
	{{{-5695, -314, 1850},0, {1063, 3207},{0x52, 0xA8, 0xCD, 0x7E}}},
	{{{-3545, -84, 4879},0, {1533, 3207},{0x52, 0xA8, 0xCD, 0x7E}}},
	{{{-3520, -314, 4844},0, {1531, 3207},{0x52, 0xA8, 0xCD, 0x7E}}},
	{{{0, -84, 6031},0, {724, 3207},{0x52, 0xA8, 0xCD, 0x7E}}},
	{{{3533, -29, 4862},0, {1539, 3207},{0x52, 0xA8, 0xCD, 0x7E}}},
	{{{5716, -29, 1857},0, {1057, 3207},{0x52, 0xA8, 0xCD, 0x7E}}},
	{{{5716, -29, -1857},0, {531, 3207},{0x52, 0xA8, 0xCD, 0x7E}}},
	{{{3533, -29, -4862},0, {1539, 3207},{0x52, 0xA8, 0xCD, 0x7E}}},
	{{{0, -29, -6010},0, {724, 3207},{0x52, 0xA8, 0xCD, 0x7E}}},
	{{{-3533, -29, -4862},0, {1529, 3207},{0x52, 0xA8, 0xCD, 0x7E}}},
	{{{-5716, -29, -1857},0, {541, 3207},{0x52, 0xA8, 0xCD, 0x7E}}},
	{{{-5716, -29, 1857},0, {1067, 3207},{0x52, 0xA8, 0xCD, 0x7E}}},
	{{{-3533, -29, 4862},0, {1529, 3207},{0x52, 0xA8, 0xCD, 0x7E}}},
	{{{0, -29, 6010},0, {724, 3207},{0x52, 0xA8, 0xCD, 0x7E}}},
	{{{3494, 0, 4809},0, {1537, 3207},{0x52, 0xA8, 0xCD, 0x7E}}},
	{{{5653, 0, 1837},0, {1060, 3207},{0x52, 0xA8, 0xCD, 0x7E}}},
	{{{5653, 0, -1837},0, {536, 3207},{0x52, 0xA8, 0xCD, 0x7E}}},
	{{{5653, 0, 1837},0, {1060, 3207},{0x52, 0xA8, 0xCD, 0x7E}}},
	{{{5716, -29, 1857},0, {1057, 3207},{0x52, 0xA8, 0xCD, 0x7E}}},
	{{{5716, -29, -1857},0, {531, 3207},{0x52, 0xA8, 0xCD, 0x7E}}},
	{{{3494, 0, -4809},0, {1537, 3207},{0x52, 0xA8, 0xCD, 0x7E}}},
	{{{3533, -29, -4862},0, {1539, 3207},{0x52, 0xA8, 0xCD, 0x7E}}},
	{{{0, 0, -5944},0, {724, 3207},{0x52, 0xA8, 0xCD, 0x7E}}},
	{{{0, -29, -6010},0, {724, 3207},{0x52, 0xA8, 0xCD, 0x7E}}},
	{{{-3494, 0, -4809},0, {1527, 3207},{0x52, 0xA8, 0xCD, 0x7E}}},
	{{{-3533, -29, -4862},0, {1529, 3207},{0x52, 0xA8, 0xCD, 0x7E}}},
	{{{-5653, 0, -1837},0, {546, 3207},{0x52, 0xA8, 0xCD, 0x7E}}},
	{{{-5716, -29, -1857},0, {541, 3207},{0x52, 0xA8, 0xCD, 0x7E}}},
	{{{-5653, 0, 1837},0, {1070, 3207},{0x52, 0xA8, 0xCD, 0x7E}}},
	{{{-5716, -29, 1857},0, {1067, 3207},{0x52, 0xA8, 0xCD, 0x7E}}},
	{{{-3494, 0, 4809},0, {1527, 3207},{0x52, 0xA8, 0xCD, 0x7E}}},
	{{{-3533, -29, 4862},0, {1529, 3207},{0x52, 0xA8, 0xCD, 0x7E}}},
	{{{0, 0, 5944},0, {724, 3207},{0x52, 0xA8, 0xCD, 0x7E}}},
	{{{0, -29, 6010},0, {724, 3207},{0x52, 0xA8, 0xCD, 0x7E}}},
	{{{3494, 0, 4809},0, {1537, 3207},{0x52, 0xA8, 0xCD, 0x7E}}},
	{{{0, 0, 4755},0, {782, 2354},{0x52, 0xA8, 0xCD, 0x7E}}},
	{{{2795, 0, 3847},0, {1432, 2354},{0x52, 0xA8, 0xCD, 0x7E}}},
	{{{4522, 0, 1469},0, {1050, 2354},{0x52, 0xA8, 0xCD, 0x7E}}},
	{{{4522, 0, -1469},0, {631, 2354},{0x52, 0xA8, 0xCD, 0x7E}}},
	{{{2795, 0, -3847},0, {1432, 2354},{0x52, 0xA8, 0xCD, 0x7E}}},
	{{{0, 0, -4755},0, {782, 2354},{0x52, 0xA8, 0xCD, 0x7E}}},
	{{{-2795, 0, -3847},0, {1424, 2354},{0x52, 0xA8, 0xCD, 0x7E}}},
	{{{-4522, 0, -1469},0, {639, 2354},{0x52, 0xA8, 0xCD, 0x7E}}},
	{{{-4522, 0, 1469},0, {1058, 2354},{0x52, 0xA8, 0xCD, 0x7E}}},
	{{{-2795, 0, 3847},0, {1424, 2354},{0x52, 0xA8, 0xCD, 0x7E}}},
	{{{-2096, 0, 2885},0, {1321, 1501},{0x52, 0xA8, 0xCC, 0x7E}}},
	{{{0, 0, 3566},0, {839, 1501},{0x52, 0xA8, 0xCC, 0x7E}}},
	{{{2096, 0, 2885},0, {1327, 1501},{0x52, 0xA8, 0xCC, 0x7E}}},
	{{{2096, 0, 2885},0, {1327, 1501},{0x52, 0xA8, 0xCC, 0x7E}}},
	{{{4522, 0, 1469},0, {1050, 2354},{0x52, 0xA8, 0xCD, 0x7E}}},
	{{{3392, 0, 1102},0, {1041, 1501},{0x52, 0xA8, 0xCC, 0x7E}}},
	{{{4522, 0, -1469},0, {631, 2354},{0x52, 0xA8, 0xCD, 0x7E}}},
	{{{3392, 0, -1102},0, {726, 1501},{0x52, 0xA8, 0xCC, 0x7E}}},
	{{{2795, 0, -3847},0, {1432, 2354},{0x52, 0xA8, 0xCD, 0x7E}}},
	{{{2096, 0, -2885},0, {1327, 1501},{0x52, 0xA8, 0xCC, 0x7E}}},
	{{{0, 0, -4755},0, {782, 2354},{0x52, 0xA8, 0xCD, 0x7E}}},
	{{{0, 0, -3566},0, {839, 1501},{0x52, 0xA8, 0xCD, 0x7E}}},
	{{{-2795, 0, -3847},0, {1424, 2354},{0x52, 0xA8, 0xCD, 0x7E}}},
	{{{-2096, 0, -2885},0, {1321, 1501},{0x52, 0xA8, 0xCC, 0x7E}}},
	{{{-4522, 0, -1469},0, {639, 2354},{0x52, 0xA8, 0xCD, 0x7E}}},
	{{{-3392, 0, -1102},0, {732, 1501},{0x52, 0xA8, 0xCC, 0x7E}}},
	{{{-4522, 0, 1469},0, {1058, 2354},{0x52, 0xA8, 0xCD, 0x7E}}},
	{{{-3392, 0, 1102},0, {1046, 1501},{0x52, 0xA8, 0xCC, 0x7E}}},
	{{{-2795, 0, 3847},0, {1424, 2354},{0x52, 0xA8, 0xCD, 0x7E}}},
	{{{-2096, 0, 2885},0, {1321, 1501},{0x52, 0xA8, 0xCC, 0x7E}}},
	{{{-2261, 0, 735},0, {1035, 649},{0x52, 0xA8, 0xCC, 0x7E}}},
	{{{-1397, 0, 1923},0, {1218, 649},{0x52, 0xA8, 0xCC, 0x7E}}},
	{{{0, 0, 3566},0, {839, 1501},{0x52, 0xA8, 0xCC, 0x7E}}},
	{{{0, 0, 2378},0, {897, 649},{0x52, 0xA8, 0xCC, 0x7E}}},
	{{{1397, 0, 1923},0, {1222, 649},{0x52, 0xA8, 0xCC, 0x7E}}},
	{{{2261, 0, 735},0, {1031, 649},{0x52, 0xA8, 0xCC, 0x7E}}},
	{{{2261, 0, -735},0, {821, 649},{0x52, 0xA8, 0xCC, 0x7E}}},
	{{{1397, 0, -1923},0, {1222, 649},{0x52, 0xA8, 0xCC, 0x7E}}},
	{{{0, 0, -2378},0, {897, 649},{0x52, 0xA8, 0xCD, 0x7E}}},
	{{{-1397, 0, -1923},0, {1218, 649},{0x52, 0xA8, 0xCC, 0x7E}}},
	{{{-2261, 0, -735},0, {825, 649},{0x52, 0xA8, 0xCC, 0x7E}}},
	{{{-1131, 0, -367},0, {918, -204},{0x52, 0xA8, 0xCC, 0x7E}}},
	{{{-1131, 0, 367},0, {1023, -204},{0x52, 0xA8, 0xCC, 0x7E}}},
	{{{-699, 0, 962},0, {1115, -204},{0x52, 0xA8, 0xCC, 0x7E}}},
	{{{0, 0, 1189},0, {954, -204},{0x52, 0xA8, 0xCC, 0x7E}}},
	{{{0, 0, 1189},0, {954, -204},{0x52, 0xA8, 0xCC, 0x7E}}},
	{{{1397, 0, 1923},0, {1222, 649},{0x52, 0xA8, 0xCC, 0x7E}}},
	{{{699, 0, 962},0, {1117, -204},{0x52, 0xA8, 0xCC, 0x7E}}},
	{{{2261, 0, 735},0, {1031, 649},{0x52, 0xA8, 0xCC, 0x7E}}},
	{{{1131, 0, 367},0, {1021, -204},{0x52, 0xA8, 0xCC, 0x7E}}},
	{{{2261, 0, -735},0, {821, 649},{0x52, 0xA8, 0xCC, 0x7E}}},
	{{{1131, 0, -367},0, {916, -204},{0x52, 0xA8, 0xCC, 0x7E}}},
	{{{1397, 0, -1923},0, {1222, 649},{0x52, 0xA8, 0xCC, 0x7E}}},
	{{{699, 0, -962},0, {1117, -204},{0x52, 0xA8, 0xCC, 0x7E}}},
	{{{0, 0, -2378},0, {897, 649},{0x52, 0xA8, 0xCD, 0x7E}}},
	{{{0, 0, -1189},0, {954, -204},{0x52, 0xA8, 0xCD, 0x7E}}},
	{{{-1397, 0, -1923},0, {1218, 649},{0x52, 0xA8, 0xCC, 0x7E}}},
	{{{-699, 0, -962},0, {1115, -204},{0x52, 0xA8, 0xCC, 0x7E}}},
	{{{-2261, 0, -735},0, {825, 649},{0x52, 0xA8, 0xCC, 0x7E}}},
	{{{-1131, 0, -367},0, {918, -204},{0x52, 0xA8, 0xCC, 0x7E}}},
	{{{0, 0, 0},0, {1012, -1057},{0x52, 0xA8, 0xCC, 0x7E}}},
	{{{-1131, 0, 367},0, {1023, -204},{0x52, 0xA8, 0xCC, 0x7E}}},
	{{{-699, 0, 962},0, {1115, -204},{0x52, 0xA8, 0xCC, 0x7E}}},
};

#ifndef _GBI_H_
#include "types.h"
#include "gbi.h"
#include "model.inc.c"
#endif

int set_water_top_dist_flags() {
    int count = 114;
    int max = 0;

    Vtx *vertices = segmented_to_virtual(water_top_vtx_copies);
    for (int i = 0; i < count; i++) {
        u16 distHor = (u16) sqrtf(vertices[i].v.ob[0] * vertices[i].v.ob[0] + vertices[i].v.ob[2] * vertices[i].v.ob[2]);
		vertices[i].v.flag = distHor;

        if (vertices[i].v.flag > max) max = vertices[i].v.flag;
	}

}

/**
 * in blender, vertex group and armature those bitches and animate it!
*/

void visual_water_top_waves() {
	int i = 0;
	int count = 114;
	int width = 64 * 0x20 * 2;
	int height = 64 * 0x20 * 2;

    static int set_flags = FALSE;

	static int currentX = 0;
	int deltaX;
	static int timeX;
	float amplitudeX = 0.25;
	float frequencyX = 0.25;
	float offsetX = 0.0;
	static int currentY = 0;
    static f32 max = 0.0f;

    if (!set_flags) {
        max = set_water_top_dist_flags();
        set_flags = TRUE;
    }

	Vtx *vertices = segmented_to_virtual(water_top_water_top_mesh_layer_5_vtx_0);
	Vtx *vertices_cpy = segmented_to_virtual(water_top_vtx_copies);

	deltaX = (int)(amplitudeX * frequencyX * coss((frequencyX * timeX + offsetX) * (1024 * 16 - 1) / 6.28318530718) * 0x20);

	if (absi(currentX) > width) {
		deltaX -= (int)(absi(currentX) / width) * width * signum_positive(deltaX);
	}

	for (i = 0; i < count; i++) {
        f32 vOff = ((f32)(vertices_cpy[i].v.flag) / max) * timeX;
		vertices[i].v.ob[1] += (int)(amplitudeX * frequencyX * coss((frequencyX * timeX + vOff) * (1024 * 16 - 1) / 6.28318530718) * 0x20);
	}
	currentX += deltaX;
    timeX += 1;
}
